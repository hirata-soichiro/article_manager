# è¨­è¨ˆæ›¸

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

Docker Composeãƒ™ãƒ¼ã‚¹ã®ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã‹ã‚‰AWS ECS (Fargate) + RDSæ§‹æˆã¸ã®ç§»è¡Œã‚’å®Ÿæ–½ã—ã¾ã™ã€‚**å€‹äººå­¦ç¿’ç”¨ã®ã‚³ã‚¹ãƒˆæœ€é©åŒ–**ã‚’æœ€å„ªå…ˆã¨ã—ã€Infrastructure as Code (Terraform) ã‚’æ¡ç”¨ã—ã€å†ç¾å¯èƒ½ã§ä¿å®ˆæ€§ã®é«˜ã„ã‚¤ãƒ³ãƒ•ãƒ©ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

### è¨­è¨ˆã®æ–¹é‡

- **ã‚³ã‚¹ãƒˆæœ€å°åŒ–**: ä¸è¦ãªã‚µãƒ¼ãƒ“ã‚¹ï¼ˆALBã€Multi-AZã€CloudWatch Metricsç­‰ï¼‰ã‚’å‰Šé™¤
- **èµ·å‹•/åœæ­¢**: ä½¿ã‚ãªã„æ™‚ã¯å®Œå…¨åœæ­¢ã—ã¦èª²é‡‘ã‚’æœ€å°åŒ–
- **ã‚·ãƒ³ãƒ—ãƒ«ã•**: å€‹äººå­¦ç¿’ã«å¿…è¦æœ€å°é™ã®æ§‹æˆ
- **å­¦ç¿’é‡è¦–**: ECS Fargateã€RDSã€Terraformã€GitHub Actionsã®å®Ÿè·µçš„ãªå­¦ç¿’

### ç§»è¡Œã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³

```
[ç¾åœ¨ã®ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒ]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Docker Compose                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚Frontend  â”‚  â”‚Backend   â”‚    â”‚
â”‚  â”‚(Next.js) â”‚  â”‚(Go API)  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚        â”‚            â”‚           â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚                    â”‚        â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚              â”‚ MySQL    â”‚   â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[AWSç§»è¡Œå¾Œã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ - ã‚³ã‚¹ãƒˆæœ€é©åŒ–ç‰ˆ]

         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Internet    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Route 53      â”‚
         â”‚  (DNS)         â”‚
         â”‚  app.example.  â”‚
         â”‚  com           â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ å‹•çš„DNSæ›´æ–°
                 â”‚ (èµ·å‹•æ™‚ã«IPã‚’æ›´æ–°)
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  VPC (10.0.0.0/16)       â”‚
    â”‚                          â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚ ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚µãƒ–ãƒãƒƒãƒˆâ”‚  â”‚
    â”‚  â”‚                   â”‚   â”‚
    â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
    â”‚  â”‚ â”‚ ECS Fargate  â”‚ â”‚   â”‚
    â”‚  â”‚ â”‚ (Frontend +  â”‚ â”‚   â”‚
    â”‚  â”‚ â”‚  Backend)    â”‚ â”‚   â”‚
    â”‚  â”‚ â”‚ ãƒ‘ãƒ–ãƒªãƒƒã‚¯IP â”‚ â”‚   â”‚
    â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚           â”‚               â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆâ”‚  â”‚
    â”‚  â”‚                   â”‚   â”‚
    â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
    â”‚  â”‚ â”‚  RDS MySQL   â”‚ â”‚   â”‚
    â”‚  â”‚ â”‚ (Single-AZ)  â”‚ â”‚   â”‚
    â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

èµ·å‹•/åœæ­¢: GitHub ActionsçµŒç”±ã§æ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼
ã‚³ã‚¹ãƒˆå‰Šæ¸›: ALBä¸ä½¿ç”¨ã€Multi-AZä¸ä½¿ç”¨ã€NAT Gatewayä¸ä½¿ç”¨
```

## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ

### 1. VPCãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­è¨ˆ

**è²¬å‹™**:
- è«–ç†çš„ã«åˆ†é›¢ã•ã‚ŒãŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç©ºé–“ã®æä¾›
- ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚µãƒ–ãƒãƒƒãƒˆã¨ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆã®åˆ†é›¢
- **ã‚³ã‚¹ãƒˆæœ€é©åŒ–**ã®ãŸã‚ã‚·ãƒ³ãƒ—ãƒ«ãªæ§‹æˆ

**å®Ÿè£…ã®è¦ç‚¹**:
- **VPC CIDR**: `10.0.0.0/16`
- **ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚µãƒ–ãƒãƒƒãƒˆ**:
  - `10.0.1.0/24` (ap-northeast-1a)
  - ç”¨é€”: ECSã‚¿ã‚¹ã‚¯é…ç½®ï¼ˆãƒ‘ãƒ–ãƒªãƒƒã‚¯IPå‰²ã‚Šå½“ã¦ï¼‰
- **ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆ**:
  - `10.0.11.0/24` (ap-northeast-1a)
  - ç”¨é€”: RDSé…ç½®
- **ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤**: ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚µãƒ–ãƒãƒƒãƒˆç”¨
- **NAT Gateway**: ä¸ä½¿ç”¨ï¼ˆã‚³ã‚¹ãƒˆå‰Šæ¸›ã€ECSã¯ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚µãƒ–ãƒãƒƒãƒˆã«é…ç½®ï¼‰
- **Single-AZæ§‹æˆ**: ap-northeast-1a ã®ã¿ä½¿ç”¨ï¼ˆMulti-AZä¸ä½¿ç”¨ï¼‰

**ã‚³ã‚¹ãƒˆå‰Šæ¸›ãƒã‚¤ãƒ³ãƒˆ**:
- âŒ Multi-AZå‰Šé™¤ï¼ˆã‚µãƒ–ãƒãƒƒãƒˆ1å€‹ãšã¤ã§ååˆ†ï¼‰
- âŒ NAT Gatewayå‰Šé™¤ï¼ˆæœˆ$30-40å‰Šæ¸›ï¼‰
- âŒ ap-northeast-1c ã‚µãƒ–ãƒãƒƒãƒˆå‰Šé™¤

### 2. ECS Fargate (ã‚³ãƒ³ãƒ†ãƒŠã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³)

**è²¬å‹™**:
- ã‚³ãƒ³ãƒ†ãƒŠã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œç’°å¢ƒæä¾›
- ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã§ã®ã‚³ãƒ³ãƒ†ãƒŠç®¡ç†
- **å›ºå®š1ã‚¿ã‚¹ã‚¯**ï¼ˆAuto Scalingä¸ä½¿ç”¨ï¼‰

**å®Ÿè£…ã®è¦ç‚¹**:
- **ECSã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼**: `article-manager-cluster`
- **Fargateã‚¿ã‚¹ã‚¯å®šç¾©** (Frontend + Backend ã‚’1ã‚¿ã‚¹ã‚¯ã«çµ±åˆ):
  - CPU: 256 (.25 vCPU)
  - Memory: 512 MB
  - ã‚³ãƒ³ãƒ†ãƒŠ1 - Frontend (Next.js):
    - Port: 3000
    - ç’°å¢ƒå¤‰æ•°: `NEXT_PUBLIC_API_URL=http://localhost:8080`
  - ã‚³ãƒ³ãƒ†ãƒŠ2 - Backend (Go API):
    - Port: 8080
    - ç’°å¢ƒå¤‰æ•°: `DB_HOST`, `DB_USER`, `DB_PASSWORD` (Secrets Managerã‹ã‚‰å–å¾—)
- **ECSã‚µãƒ¼ãƒ“ã‚¹**:
  - Desired Count: 1ã‚¿ã‚¹ã‚¯ï¼ˆå›ºå®šï¼‰
  - Launch Type: FARGATE
  - Network Mode: awsvpc
  - ã‚µãƒ–ãƒãƒƒãƒˆ: ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚µãƒ–ãƒãƒƒãƒˆ
  - **ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPå‰²ã‚Šå½“ã¦**: æœ‰åŠ¹ï¼ˆENABLEDï¼‰
  - Health Check: ãªã—ï¼ˆALBä¸ä½¿ç”¨ã®ãŸã‚ï¼‰
- **èµ·å‹•/åœæ­¢**:
  - GitHub Actionsã§ `desired_count` ã‚’ 0 â†” 1 ã«å¤‰æ›´
  - åœæ­¢ä¸­ã¯ECSèª²é‡‘ãªã—

**ã‚³ã‚¹ãƒˆå‰Šæ¸›ãƒã‚¤ãƒ³ãƒˆ**:
- âœ… Frontend + Backend ã‚’1ã‚¿ã‚¹ã‚¯ã«çµ±åˆï¼ˆã‚¿ã‚¹ã‚¯æ•°å‰Šæ¸›ï¼‰
- âŒ Auto Scalingå‰Šé™¤
- âŒ ALBå‰Šé™¤ï¼ˆç›´æ¥ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã§ã‚¢ã‚¯ã‚»ã‚¹ï¼‰

### 3. Amazon RDS for MySQLï¼ˆæœ€å°æ§‹æˆï¼‰

**è²¬å‹™**:
- ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒãƒãƒ¼ã‚¸ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹æä¾›
- è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆæœ€å°é™ï¼‰
- **Single-AZæ§‹æˆ**ï¼ˆã‚³ã‚¹ãƒˆæœ€å°åŒ–ï¼‰

**å®Ÿè£…ã®è¦ç‚¹**:
- **ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¯ãƒ©ã‚¹**: `db.t4g.micro` (2 vCPU, 1 GB RAM) - ç„¡æ–™æ å¯¾è±¡
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: General Purpose SSD (gp3), 20 GB (åˆæœŸ)
- **ã‚¨ãƒ³ã‚¸ãƒ³**: MySQL 8.0
- **Multi-AZ**: **ç„¡åŠ¹**ï¼ˆSingle-AZã€ã‚³ã‚¹ãƒˆå‰Šæ¸›ï¼‰
- **AZ**: ap-northeast-1a
- **è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**: æœ‰åŠ¹ã€ä¿æŒæœŸé–“**1æ—¥**ï¼ˆæœ€å°é™ï¼‰
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å**: `article_manager`
- **ãƒã‚¹ã‚¿ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼å**: `admin` (Secrets Managerã§ç®¡ç†)
- **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚°ãƒ«ãƒ¼ãƒ—**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ (mysql8.0)
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—**: ECSã‚¿ã‚¹ã‚¯ã‹ã‚‰ã®ãƒãƒ¼ãƒˆ3306ã®ã¿è¨±å¯
- **èµ·å‹•/åœæ­¢**:
  - GitHub Actionsã§ RDS ã‚’ start â†” stop
  - åœæ­¢ä¸­ã¯ç´„90%ã®ã‚³ã‚¹ãƒˆå‰Šæ¸›ï¼ˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸èª²é‡‘ã®ã¿ï¼‰

**ã‚³ã‚¹ãƒˆå‰Šæ¸›ãƒã‚¤ãƒ³ãƒˆ**:
- âŒ Multi-AZå‰Šé™¤ï¼ˆã‚³ã‚¹ãƒˆåŠæ¸›ï¼‰
- ğŸ“ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¿æŒæœŸé–“: 7æ—¥ â†’ 1æ—¥
- âœ… èµ·å‹•/åœæ­¢ã§æ›´ã«ã‚³ã‚¹ãƒˆå‰Šæ¸›

### 4. Route 53 (å‹•çš„DNSç®¡ç†)

**è²¬å‹™**:
- ãƒ‰ãƒ¡ã‚¤ãƒ³ã®DNSç®¡ç†
- ECSã‚¿ã‚¹ã‚¯ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã¸ã®å‹•çš„ãªAãƒ¬ã‚³ãƒ¼ãƒ‰æ›´æ–°
- **ALBä¸ä½¿ç”¨**ã§ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¢ã‚¯ã‚»ã‚¹å®Ÿç¾

**å®Ÿè£…ã®è¦ç‚¹**:
- **ãƒ›ã‚¹ãƒˆã‚¾ãƒ¼ãƒ³**: å–å¾—ã—ãŸãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆä¾‹: `example.com`ï¼‰
- **Aãƒ¬ã‚³ãƒ¼ãƒ‰**: `app.example.com`
- **å‹•çš„DNSæ›´æ–°ãƒ•ãƒ­ãƒ¼**:
  1. GitHub Actionsã§ã‚¿ã‚¹ã‚¯èµ·å‹•
  2. ECSã‚¿ã‚¹ã‚¯ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚’å–å¾—ï¼ˆAWS CLIï¼‰
  3. Route 53ã®Aãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æ›´æ–°ï¼ˆ`aws route53 change-resource-record-sets`ï¼‰
  4. TTL: 60ç§’ï¼ˆå¤‰æ›´ã®åæ˜ ã‚’æ—©ã‚ã‚‹ï¼‰
- **HTTPã®ã¿å¯¾å¿œ**: HTTPSã¯Phase 2ã§Let's Encryptæ¤œè¨

**ã‚³ã‚¹ãƒˆ**:
- ãƒ›ã‚¹ãƒˆã‚¾ãƒ¼ãƒ³: $0.50/æœˆ
- ã‚¯ã‚¨ãƒªæ–™é‡‘: ã»ã¼ç„¡æ–™ï¼ˆå€‹äººåˆ©ç”¨ï¼‰

**ã‚³ã‚¹ãƒˆå‰Šæ¸›ãƒã‚¤ãƒ³ãƒˆ**:
- âŒ ALBå‰Šé™¤ï¼ˆæœˆ$20å‰Šæ¸›ï¼‰
- âœ… Route 53ã®ã¿ã§$0.50/æœˆ

### 5. Secrets Manager / Parameter Store

**è²¬å‹™**:
- æ©Ÿå¯†æƒ…å ± (DBãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€APIã‚­ãƒ¼) ã®å®‰å…¨ãªç®¡ç†
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šã®ä¸€å…ƒç®¡ç†

**å®Ÿè£…ã®è¦ç‚¹**:
- **Secrets Manager** (æ©Ÿå¯†æƒ…å ±):
  - `/article-manager/db/password` - RDSãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
  - `/article-manager/api/gemini-api-key` - Gemini APIã‚­ãƒ¼
  - `/article-manager/api/google-books-api-key` - Google Books APIã‚­ãƒ¼
- **Systems Manager Parameter Store** (éæ©Ÿå¯†è¨­å®š):
  - `/article-manager/db/host` - RDSã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
  - `/article-manager/db/name` - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å (`article_manager`)
  - `/article-manager/db/user` - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¦ãƒ¼ã‚¶ãƒ¼å (`admin`)

### 6. ECR (Elastic Container Registry)

**è²¬å‹™**:
- Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä¿å­˜ã¨ç®¡ç†
- CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¨ã®çµ±åˆ

**å®Ÿè£…ã®è¦ç‚¹**:
- **ãƒªãƒã‚¸ãƒˆãƒª**:
  - `article-manager-app` (Frontend + Backendã‚’å«ã‚€çµ±åˆã‚¤ãƒ¡ãƒ¼ã‚¸)
  - ã¾ãŸã¯åˆ†é›¢:
    - `article-manager-frontend` (Next.jsã‚¤ãƒ¡ãƒ¼ã‚¸)
    - `article-manager-api` (Go APIã‚¤ãƒ¡ãƒ¼ã‚¸)
- **ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¿ã‚°æˆ¦ç•¥**:
  - `latest` - æœ€æ–°ã®å®‰å®šç‰ˆ
  - `{git-sha}` - ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥
- **ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒãƒªã‚·ãƒ¼**: æœªä½¿ç”¨ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’30æ—¥å¾Œã«è‡ªå‹•å‰Šé™¤

### 7. CloudWatch Logsï¼ˆæœ€å°æ§‹æˆï¼‰

**è²¬å‹™**:
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚°ã®é›†ç´„ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
- **Metrics/Alarmsã¯ä¸ä½¿ç”¨**ï¼ˆã‚³ã‚¹ãƒˆå‰Šæ¸›ï¼‰

**å®Ÿè£…ã®è¦ç‚¹**:
- **ãƒ­ã‚°ã‚°ãƒ«ãƒ¼ãƒ—**:
  - `/ecs/article-manager-app`
  - ä¿æŒæœŸé–“: **1æ—¥**ï¼ˆã‚³ã‚¹ãƒˆæœ€å°åŒ–ï¼‰
- **ãƒ¡ãƒˆãƒªã‚¯ã‚¹**: ä¸ä½¿ç”¨ï¼ˆå€‹äººå­¦ç¿’ã«ã¯ä¸è¦ï¼‰
- **ã‚¢ãƒ©ãƒ¼ãƒ **: ä¸ä½¿ç”¨ï¼ˆå€‹äººå­¦ç¿’ã«ã¯ä¸è¦ï¼‰

**ã‚³ã‚¹ãƒˆå‰Šæ¸›ãƒã‚¤ãƒ³ãƒˆ**:
- âŒ CloudWatch Metricså‰Šé™¤
- âŒ CloudWatch Alarmså‰Šé™¤
- ğŸ“ ãƒ­ã‚°ä¿æŒæœŸé–“: 30æ—¥ â†’ 1æ—¥

### 8. Terraformå®Ÿè¡Œç”¨GitHub Actionsãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

**è²¬å‹™**:
- ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒä¸è¦ã§Terraformã‚’å®Ÿè¡Œ
- AWSèªè¨¼æƒ…å ±ã‚’GitHub Secretsã§å®‰å…¨ã«ç®¡ç†
- ã‚¤ãƒ³ãƒ•ãƒ©ã®ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã‚’è‡ªå‹•åŒ–

**å®Ÿè£…ã®è¦ç‚¹**:
- **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼**: `.github/workflows/terraform-apply.yml`
- **ãƒˆãƒªã‚¬ãƒ¼**: `workflow_dispatch`ï¼ˆæ‰‹å‹•å®Ÿè¡Œï¼‰
- **ã‚¹ãƒ†ãƒƒãƒ—**:
  1. AWSèªè¨¼æƒ…å ±ã‚’è¨­å®šï¼ˆGitHub Secretsä½¿ç”¨ï¼‰
  2. Terraformã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆhashicorp/setup-terraform actionï¼‰
  3. `terraform init`
  4. `terraform plan`ï¼ˆå¤‰æ›´å†…å®¹ã‚’ç¢ºèªï¼‰
  5. `terraform apply -auto-approve`ï¼ˆæ‰¿èªå¾Œã«å®Ÿè¡Œï¼‰
- **å¿…è¦ãªGitHub Secrets**:
  - `AWS_ACCESS_KEY_ID`
  - `AWS_SECRET_ACCESS_KEY`
  - `AWS_REGION` (ap-northeast-1)
  - `TF_VAR_db_master_password`ï¼ˆRDSãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼‰
  - `TF_VAR_domain_name`ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³åï¼‰

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®**:
- AWSèªè¨¼æƒ…å ±ã¯GitHub Secretsã§æš—å·åŒ–
- ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã«èªè¨¼æƒ…å ±ã‚’ä¿å­˜ã—ãªã„
- terraform planã®çµæœã‚’ãƒ­ã‚°ã§ç¢ºèªã—ã¦ã‹ã‚‰apply

### 9. èµ·å‹•/åœæ­¢æ©Ÿèƒ½ï¼ˆGitHub Actionsï¼‰

**è²¬å‹™**:
- ã‚³ã‚¹ãƒˆæœ€å°åŒ–ã®ãŸã‚ã®èµ·å‹•/åœæ­¢ã®è‡ªå‹•åŒ–
- Route 53ã®å‹•çš„DNSæ›´æ–°

**å®Ÿè£…ã®è¦ç‚¹**:
- **èµ·å‹•ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼** (`.github/workflows/start-infrastructure.yml`):
  1. RDSã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’èµ·å‹• (`aws rds start-db-instance`)
  2. RDSèµ·å‹•å®Œäº†ã‚’å¾…æ©Ÿï¼ˆç´„5åˆ†ï¼‰
  3. ECSã‚µãƒ¼ãƒ“ã‚¹ã®desired_countã‚’1ã«è¨­å®š
  4. ECSã‚¿ã‚¹ã‚¯èµ·å‹•å®Œäº†ã‚’å¾…æ©Ÿ
  5. ECSã‚¿ã‚¹ã‚¯ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚’å–å¾—
  6. Route 53ã®Aãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æ›´æ–°
  7. å®Œäº†é€šçŸ¥ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³URLã‚’è¡¨ç¤ºï¼‰
- **åœæ­¢ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼** (`.github/workflows/stop-infrastructure.yml`):
  1. ECSã‚µãƒ¼ãƒ“ã‚¹ã®desired_countã‚’0ã«è¨­å®šï¼ˆã‚¿ã‚¹ã‚¯åœæ­¢ï¼‰
  2. RDSã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’åœæ­¢ (`aws rds stop-db-instance`)
  3. å®Œäº†é€šçŸ¥
- **æ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼**: `workflow_dispatch` ã§ GitHub UI ã‹ã‚‰å®Ÿè¡Œ

**ã‚³ã‚¹ãƒˆå‰Šæ¸›åŠ¹æœ**:
- é€±20æ™‚é–“ç¨¼åƒ: ç´„$6/æœˆ
- é€±40æ™‚é–“ç¨¼åƒ: ç´„$11/æœˆ
- å¸¸æ™‚èµ·å‹•: ç´„$22/æœˆ

## ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ•ãƒ­ãƒ¼ (è¨˜äº‹ä¸€è¦§å–å¾—)

```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ–ãƒ©ã‚¦ã‚¶ã§ http://app.example.com ã«ã‚¢ã‚¯ã‚»ã‚¹
2. Route 53ãŒECSã‚¿ã‚¹ã‚¯ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆä¾‹: 3.112.x.xï¼‰ã‚’è¿”å´
3. ãƒ–ãƒ©ã‚¦ã‚¶ãŒECSã‚¿ã‚¹ã‚¯ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã«ç›´æ¥HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆ
4. ECSã‚¿ã‚¹ã‚¯å†…ã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆãƒãƒ¼ãƒˆ80ï¼‰ãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡
   - Nginxãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·: / â†’ Frontend (3000), /api/* â†’ Backend (8080)
5. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãŒãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ (localhost:8080/api/articles)
6. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒRDSã«æ¥ç¶šã—ã¦ãƒ‡ãƒ¼ã‚¿å–å¾— (ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯)
7. RDSãŒè¨˜äº‹ãƒ‡ãƒ¼ã‚¿ã‚’è¿”å´
8. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒJSONå½¢å¼ã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹
9. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãŒHTMLã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
10. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”å´
```

### èµ·å‹•ãƒ•ãƒ­ãƒ¼

```
1. GitHub Actionsã§Start Infrastructureãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’æ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼
2. AWS CLI ã§ RDSèµ·å‹•: aws rds start-db-instance --db-instance-identifier article-manager-db
3. RDSèµ·å‹•å®Œäº†ã‚’å¾…æ©Ÿï¼ˆç´„5åˆ†ï¼‰
4. AWS CLI ã§ ECS desired_count ã‚’1ã«è¨­å®š
5. ECSã‚¿ã‚¹ã‚¯ãŒèµ·å‹•ï¼ˆç´„2åˆ†ï¼‰
6. AWS CLI ã§ã‚¿ã‚¹ã‚¯ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚’å–å¾—
7. Route 53 ã® Aãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æ›´æ–°: app.example.com â†’ 3.112.x.x
8. å®Œäº†é€šçŸ¥: "èµ·å‹•å®Œäº†ã€‚http://app.example.com ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½"
```

### åœæ­¢ãƒ•ãƒ­ãƒ¼

```
1. GitHub Actionsã§Stop Infrastructureãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’æ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼
2. AWS CLI ã§ ECS desired_count ã‚’0ã«è¨­å®š
3. ECSã‚¿ã‚¹ã‚¯ãŒåœæ­¢ï¼ˆç´„1åˆ†ï¼‰
4. AWS CLI ã§ RDSåœæ­¢: aws rds stop-db-instance --db-instance-identifier article-manager-db
5. å®Œäº†é€šçŸ¥: "åœæ­¢å®Œäº†ã€‚èª²é‡‘ãŒæœ€å°åŒ–ã•ã‚Œã¾ã—ãŸ"
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ãƒ­ãƒ¼

```
1. ãƒ­ãƒ¼ã‚«ãƒ«MySQLã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’dumpãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
   docker exec db mysqldump -u root -p article_manager > local_dump.sql

2. dumpãƒ•ã‚¡ã‚¤ãƒ«ã‚’S3ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ (ä¸€æ™‚çš„)
   aws s3 cp local_dump.sql s3://article-manager-temp-bucket/

3. EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ (è¸ã¿å°) ã‚’èµ·å‹•ã—ã€S3ã‹ã‚‰dumpãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
   aws s3 cp s3://article-manager-temp-bucket/local_dump.sql .

4. EC2ã‹ã‚‰RDSã«ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
   mysql -h <rds-endpoint> -u admin -p article_manager < local_dump.sql

5. ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã‚’ç¢ºèª
   - ãƒ†ãƒ¼ãƒ–ãƒ«æ•°ã€ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°ã®ä¸€è‡´ç¢ºèª
   - ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®æŠ½å‡ºã¨æ¯”è¼ƒ

6. EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å‰Šé™¤ã€S3ãƒã‚±ãƒƒãƒˆã‚’å‰Šé™¤
```

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æˆ¦ç•¥

### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ãƒ™ãƒ«

- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼**: è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ (æœ€å¤§3å›)ã€å¤±æ•—æ™‚ã¯5xxã‚¨ãƒ©ãƒ¼
- **å¤–éƒ¨API (Gemini, Google Books) ã‚¨ãƒ©ãƒ¼**: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ30ç§’ã€å¤±æ•—æ™‚ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€šçŸ¥
- **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼**: 400ã‚¨ãƒ©ãƒ¼ã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«è©³ç´°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”ã™

### ã‚¤ãƒ³ãƒ•ãƒ©ãƒ¬ãƒ™ãƒ«

- **ECSã‚¿ã‚¹ã‚¯ç•°å¸¸çµ‚äº†**: ECSã‚µãƒ¼ãƒ“ã‚¹ãŒè‡ªå‹•çš„ã«æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’èµ·å‹•
- **RDSéšœå®³**: Single-AZæ§‹æˆã®ãŸã‚ã€æ‰‹å‹•ã§å¾©æ—§ï¼ˆRDSã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‹ã‚‰å¾©å…ƒï¼‰
- **ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPå¤‰æ›´**: ã‚¿ã‚¹ã‚¯å†èµ·å‹•æ™‚ã«IPãŒå¤‰ã‚ã‚‹ãŸã‚ã€èµ·å‹•ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§è‡ªå‹•çš„ã«Route 53æ›´æ–°

## ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### ã‚¤ãƒ³ãƒ•ãƒ©ãƒ†ã‚¹ãƒˆ

- **Terraform Validate**: `terraform validate` ã§æ§‹æ–‡ãƒã‚§ãƒƒã‚¯
- **Terraform Plan**: `terraform plan` ã§å¤‰æ›´å†…å®¹ã®ç¢ºèª
- **æ‰‹å‹•æ¤œè¨¼**: ãƒªã‚½ãƒ¼ã‚¹ä½œæˆå¾Œã€AWS Management Consoleã§ç¢ºèª
  - VPCã€ã‚µãƒ–ãƒãƒƒãƒˆã€ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã®ç¢ºèª
  - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒ«ãƒ¼ãƒ«ç¢ºèª
  - ECSã‚¿ã‚¹ã‚¯ã®èµ·å‹•ç¢ºèªã¨ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPå–å¾—
  - RDSæ¥ç¶šç¢ºèª

### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ

- **ãƒ­ãƒ¼ã‚«ãƒ«â†’AWSç’°å¢ƒå¤‰æ•°åˆ‡ã‚Šæ›¿ãˆãƒ†ã‚¹ãƒˆ**: `DB_HOST`ã‚’RDSã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«å¤‰æ›´ã—ã¦å‹•ä½œç¢ºèª
- **ECSä¸Šã§ã®å‹•ä½œç¢ºèª**: CloudWatch Logsã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚°ã‚’ç¢ºèª
- **E2Eãƒ†ã‚¹ãƒˆ**: ãƒ–ãƒ©ã‚¦ã‚¶ã§å®Ÿéš›ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€è¨˜äº‹ã®CRUDæ“ä½œã‚’å®Ÿè¡Œ

### èµ·å‹•/åœæ­¢ãƒ†ã‚¹ãƒˆ

- **èµ·å‹•ãƒ†ã‚¹ãƒˆ**: GitHub Actionsãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒæ­£å¸¸ã«å®Œäº†ã—ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- **åœæ­¢ãƒ†ã‚¹ãƒˆ**: ã‚¿ã‚¹ã‚¯ã¨RDSãŒåœæ­¢ã—ã€èª²é‡‘ãŒæœ€å°åŒ–ã•ã‚Œã‚‹
- **DNSæ›´æ–°ãƒ†ã‚¹ãƒˆ**: èµ·å‹•ã®ãŸã³ã«Route 53ãŒæ­£ã—ãæ›´æ–°ã•ã‚Œã‚‹

## ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

### æ–°è¦è¿½åŠ 

```json
{
  "devDependencies": {
    "terraform": "~> 1.7.0"
  }
}
```

### Dockerfileã®å¤‰æ›´

#### Option A: çµ±åˆã‚¤ãƒ¡ãƒ¼ã‚¸ (Frontend + Backend + Nginx)

```dockerfile
# Multi-container image with Nginx reverse proxy
FROM nginx:alpine AS nginx-base

# Frontend build
FROM node:20-alpine AS frontend-builder
WORKDIR /app
COPY frontend/package*.json ./
RUN npm ci
COPY frontend/ .
RUN npm run build

# Backend build
FROM golang:1.25-alpine AS backend-builder
WORKDIR /app
COPY api/go.mod api/go.sum ./
RUN go mod download
COPY api/ .
RUN CGO_ENABLED=0 GOOS=linux go build -o server cmd/server/main.go

# Final image
FROM nginx:alpine
# Copy Nginx config
COPY nginx.conf /etc/nginx/nginx.conf
# Copy frontend build
COPY --from=frontend-builder /app/.next /var/www/frontend/.next
COPY --from=frontend-builder /app/public /var/www/frontend/public
COPY --from=frontend-builder /app/node_modules /var/www/frontend/node_modules
COPY --from=frontend-builder /app/package.json /var/www/frontend/package.json
# Copy backend binary
COPY --from=backend-builder /app/server /usr/local/bin/server
# Start script
COPY start.sh /start.sh
RUN chmod +x /start.sh
EXPOSE 80
CMD ["/start.sh"]
```

#### Option B: åˆ†é›¢ã‚¤ãƒ¡ãƒ¼ã‚¸ (æ¨å¥¨)

**Frontend (frontend/Dockerfile)**:
```dockerfile
FROM node:20-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

FROM node:20-alpine
WORKDIR /app
COPY --from=builder /app/.next ./.next
COPY --from=builder /app/public ./public
COPY --from=builder /app/node_modules ./node_modules
COPY --from=builder /app/package.json ./package.json
EXPOSE 3000
CMD ["npm", "run", "start"]
```

**Backend (api/Dockerfile)**:
```dockerfile
FROM golang:1.25-alpine AS builder
WORKDIR /app
COPY go.mod go.sum ./
RUN go mod download
COPY . .
RUN CGO_ENABLED=0 GOOS=linux go build -o server cmd/server/main.go

FROM alpine:latest
WORKDIR /root/
COPY --from=builder /app/server .
EXPOSE 8080
CMD ["./server"]
```

**ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `/api/health` ã‚’å®Ÿè£…

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

### æ–°è¦è¿½åŠ ãƒ•ã‚¡ã‚¤ãƒ«

```
article_manager/
â”œâ”€â”€ terraform/                           # Terraformã‚³ãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ main.tf                          # ãƒ¡ã‚¤ãƒ³ã®è¨­å®š
â”‚   â”œâ”€â”€ variables.tf                     # å¤‰æ•°å®šç¾©
â”‚   â”œâ”€â”€ outputs.tf                       # å‡ºåŠ›å®šç¾©
â”‚   â”œâ”€â”€ backend.tf                       # S3ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è¨­å®š
â”‚   â”œâ”€â”€ provider.tf                      # AWSãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼è¨­å®š
â”‚   â”œâ”€â”€ vpc.tf                           # VPCãƒªã‚½ãƒ¼ã‚¹
â”‚   â”œâ”€â”€ ecs.tf                           # ECSãƒªã‚½ãƒ¼ã‚¹
â”‚   â”œâ”€â”€ rds.tf                           # RDSãƒªã‚½ãƒ¼ã‚¹
â”‚   â”œâ”€â”€ route53.tf                       # Route 53ãƒªã‚½ãƒ¼ã‚¹
â”‚   â”œâ”€â”€ ecr.tf                           # ECRãƒªã‚½ãƒ¼ã‚¹
â”‚   â”œâ”€â”€ cloudwatch.tf                    # CloudWatch Logsãƒªã‚½ãƒ¼ã‚¹
â”‚   â”œâ”€â”€ iam.tf                           # IAMãƒ­ãƒ¼ãƒ«ãƒ»ãƒãƒªã‚·ãƒ¼
â”‚   â”œâ”€â”€ security-groups.tf               # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—
â”‚   â”œâ”€â”€ secrets.tf                       # Secrets Manager / Parameter Store
â”‚   â””â”€â”€ terraform.tfvars.example         # å¤‰æ•°ã®ä¾‹
â”‚
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â”œâ”€â”€ deploy.yml                   # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆmainãƒ–ãƒ©ãƒ³ãƒpushæ™‚ï¼‰
â”‚       â”œâ”€â”€ start-infrastructure.yml     # ã‚¤ãƒ³ãƒ•ãƒ©èµ·å‹•ï¼ˆæ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼ï¼‰
â”‚       â””â”€â”€ stop-infrastructure.yml      # ã‚¤ãƒ³ãƒ•ãƒ©åœæ­¢ï¼ˆæ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼ï¼‰
â”‚
â”œâ”€â”€ scripts/                             # ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»é‹ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”œâ”€â”€ update-route53.sh                # Route 53 DNSæ›´æ–°ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”œâ”€â”€ migrate-to-rds.sh                # RDSã¸ã®ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â””â”€â”€ backup-rds.sh                    # RDSãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
â”‚
â””â”€â”€ docs/
    â”œâ”€â”€ aws-migration-guide.md           # AWSç§»è¡Œã‚¬ã‚¤ãƒ‰
    â””â”€â”€ runbook.md                       # é‹ç”¨æ‰‹é †æ›¸
```

## å®Ÿè£…ã®é †åº

### Phase 1: åŸºç›¤æ§‹ç¯‰ (Week 1)

1. **Terraformã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**
   - S3ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ä½œæˆ (terraform.tfstateä¿å­˜ç”¨)
   - VPCãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹ç¯‰ï¼ˆSingle-AZã€ã‚·ãƒ³ãƒ—ãƒ«æ§‹æˆï¼‰
   - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆ
2. **RDSæ§‹ç¯‰**
   - RDSã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆï¼ˆSingle-AZã€db.t4g.microï¼‰
   - Secrets Managerã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç®¡ç†
3. **ECRä½œæˆ**
   - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ãƒªãƒã‚¸ãƒˆãƒª

### Phase 2: ã‚³ãƒ³ãƒ†ãƒŠãƒ‡ãƒ—ãƒ­ã‚¤ (Week 2)

4. **Dockerã‚¤ãƒ¡ãƒ¼ã‚¸æœ€é©åŒ–**
   - ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰å®Ÿè£…
   - Frontend + Backend ã®çµ±åˆï¼ˆã¾ãŸã¯åˆ†é›¢ï¼‰
5. **ECRã¸ã®ã‚¤ãƒ¡ãƒ¼ã‚¸push**
   - æ‰‹å‹•ã§ãƒ“ãƒ«ãƒ‰ãƒ»push (åˆå›)
6. **ECS Fargateæ§‹ç¯‰**
   - ã‚¿ã‚¹ã‚¯å®šç¾©ä½œæˆï¼ˆãƒ‘ãƒ–ãƒªãƒƒã‚¯IPå‰²ã‚Šå½“ã¦ï¼‰
   - ECSã‚µãƒ¼ãƒ“ã‚¹ä½œæˆ
   - ç’°å¢ƒå¤‰æ•°æ³¨å…¥ãƒ†ã‚¹ãƒˆ
7. **Route 53è¨­å®š**
   - ãƒ›ã‚¹ãƒˆã‚¾ãƒ¼ãƒ³ä½œæˆ
   - Aãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆï¼ˆæ‰‹å‹•ã§åˆæœŸIPè¨­å®šï¼‰

### Phase 3: ãƒ‡ãƒ¼ã‚¿ç§»è¡Œ (Week 2)

8. **RDSã¸ã®ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**
   - ãƒ­ãƒ¼ã‚«ãƒ«MySQLã‹ã‚‰dumpãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
   - S3çµŒç”±ã§RDSã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
   - ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ç¢ºèª

### Phase 4: CI/CDãƒ»èµ·å‹•åœæ­¢ (Week 3)

9. **GitHub Actionsè¨­å®š**
   - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆmainãƒ–ãƒ©ãƒ³ãƒpushæ™‚ï¼‰
   - ã‚¤ãƒ³ãƒ•ãƒ©èµ·å‹•ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆæ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼ï¼‰
   - ã‚¤ãƒ³ãƒ•ãƒ©åœæ­¢ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆæ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼ï¼‰
   - Route 53å‹•çš„DNSæ›´æ–°ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

### Phase 5: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»ãƒ†ã‚¹ãƒˆ (Week 3-4)

10. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ**
    - é‹ç”¨æ‰‹é †æ›¸ (runbook.md)
    - AWSç§»è¡Œã‚¬ã‚¤ãƒ‰ (aws-migration-guide.md)
11. **ç·åˆãƒ†ã‚¹ãƒˆ**
    - èµ·å‹•/åœæ­¢ãƒ†ã‚¹ãƒˆ
    - ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ†ã‚¹ãƒˆ
    - E2Eå‹•ä½œç¢ºèª

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- **æœ€å°æ¨©é™ã®åŸå‰‡**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã§å¿…è¦æœ€å°é™ã®ãƒãƒ¼ãƒˆã®ã¿è¨±å¯
- **ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆé…ç½®**: RDSã¯ç›´æ¥ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«å…¬é–‹ã—ãªã„
- **ECSãƒ‘ãƒ–ãƒªãƒƒã‚¯é…ç½®**: å€‹äººå­¦ç¿’ã®ãŸã‚ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚µãƒ–ãƒãƒƒãƒˆã«é…ç½®ï¼ˆALBå‰Šæ¸›ã®ãŸã‚ï¼‰

### èªè¨¼ãƒ»èªå¯

- **IAMãƒ­ãƒ¼ãƒ«**: ECSã‚¿ã‚¹ã‚¯ã«å¿…è¦æœ€å°é™ã®æ¨©é™ã‚’ä»˜ä¸
  - Secrets Managerèª­ã¿å–ã‚Šæ¨©é™
  - CloudWatch Logsæ›¸ãè¾¼ã¿æ¨©é™
  - ECR pullæ¨©é™
- **RDSèªè¨¼**: ãƒã‚¹ã‚¿ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯Secrets Managerã§ç®¡ç†

### ãƒ‡ãƒ¼ã‚¿ä¿è­·

- **æš—å·åŒ–**:
  - RDSã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸: AES-256æš—å·åŒ– (at rest)
  - Secrets Manager: AWS KMSæš—å·åŒ–
- **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**: RDSè‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æœ‰åŠ¹åŒ– (1æ—¥ä¿æŒ)

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®äº‹é …

### ã‚³ã‚¹ãƒˆæœ€é©åŒ–ï¼ˆæœ€å„ªå…ˆï¼‰

- **Fargate**: æœ€å°æ§‹æˆ (256 CPU, 512 MB)ã€å›ºå®š1ã‚¿ã‚¹ã‚¯
- **RDS**: db.t4g.micro (ç„¡æ–™æ å¯¾è±¡)ã€Single-AZ
- **NAT Gateway**: ä¸ä½¿ç”¨ï¼ˆæœˆ$30-40å‰Šæ¸›ï¼‰
- **ALB**: ä¸ä½¿ç”¨ï¼ˆæœˆ$20å‰Šæ¸›ï¼‰
- **CloudWatch Logs**: ä¿æŒæœŸé–“1æ—¥ï¼ˆã‚³ã‚¹ãƒˆæœ€å°åŒ–ï¼‰
- **èµ·å‹•/åœæ­¢**: GitHub ActionsçµŒç”±ã§æ‰‹å‹•ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«

### ã‚³ã‚¹ãƒˆè©¦ç®—

| æ§‹æˆ | æœˆé¡ã‚³ã‚¹ãƒˆ |
|------|-----------|
| å¸¸æ™‚èµ·å‹• | ç´„$22/æœˆ |
| é€±20æ™‚é–“ç¨¼åƒ | ç´„$6/æœˆ |
| é€±40æ™‚é–“ç¨¼åƒ | ç´„$11/æœˆ |

**ç›®æ¨™**: æœˆ$10ä»¥å†…ï¼ˆèµ·å‹•/åœæ­¢ã‚’æ´»ç”¨ï¼‰

### ãƒ¬ã‚¹ãƒãƒ³ã‚¹æœ€é©åŒ–

- **ECSã‚¿ã‚¹ã‚¯èµ·å‹•æ™‚é–“**: ç´„2åˆ†
- **RDSèµ·å‹•æ™‚é–“**: ç´„5åˆ†
- **DNSæ›´æ–°åæ˜ **: TTL 60ç§’è¨­å®šã§1åˆ†ä»¥å†…
- **RDSæ¥ç¶šãƒ—ãƒ¼ãƒ«**: Goã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã§å®Ÿè£… (max 5 connections)

## å°†æ¥ã®æ‹¡å¼µæ€§ï¼ˆPhase 2ä»¥é™ï¼‰

### HTTPSå¯¾å¿œ

- **Let's Encrypt**: ECSã‚¿ã‚¹ã‚¯å†…ã§Certbotã‚’ä½¿ç”¨ã—ã¦è¨¼æ˜æ›¸å–å¾—ãƒ»æ›´æ–°
- **CloudFlare**: ç„¡æ–™ãƒ—ãƒ©ãƒ³ã§HTTPSãƒ—ãƒ­ã‚­ã‚·ã¨ã—ã¦åˆ©ç”¨

### ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆ

- **ECS Auto Scaling**: å¿…è¦ã«å¿œã˜ã¦ã‚¿ã‚¹ã‚¯æ•°ã‚’å¢—åŠ 
- **RDS Read Replica**: èª­ã¿å–ã‚Šè² è·ãŒé«˜ã„å ´åˆã«å°å…¥æ¤œè¨ï¼ˆã‚³ã‚¹ãƒˆå¢—åŠ ï¼‰

### ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°å¼·åŒ–

- **CloudWatch Metrics/Alarms**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ãŒå¿…è¦ã«ãªã£ãŸå ´åˆã«è¿½åŠ 
- **CloudWatch Logsä¿æŒæœŸé–“å»¶é•·**: ãƒ‡ãƒãƒƒã‚°ãŒå¿…è¦ãªå ´åˆã«7æ—¥ã«å»¶é•·
